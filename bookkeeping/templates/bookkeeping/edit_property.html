{% extends 'bookkeeping/base.html' %}
{% block title %}{{ property.name }}{% endblock %}

{% block content %}
<div class="w-full max-w-6xl mx-auto">
  <!-- Page Title -->
  <div class="text-center mb-5 mt-2">
      <h1 class="text-xl font-light">{{ property.name }}</h1>
  </div>

  <!-- Dropdown for Edit Property -->
  <div class="mb-5">
      <details class="dropdown">
          <summary class="btn btn-outline">Edit Property Details</summary>
          <div class="dropdown-content bg-base-100 shadow p-4 w-full mt-2">
              <!-- Edit Property Form -->
              <div>
                  <!-- Property Details -->
                  <div class="mb-4">
                      <label class="label">
                          <span class="label-text">Property Name</span>
                      </label>
                      <input type="text" name="name" class="input input-bordered w-full" value="{{ property.name }}" required>
                  </div>
                  <div class="mb-4">
                      <label class="label">
                          <span class="label-text">Property Type</span>
                      </label>
                      <select name="property_type" class="select select-bordered w-full" required>
                          <option value="residential" {% if property.property_type == "residential" %}selected{% endif %}>Residential</option>
                          <option value="commercial" {% if property.property_type == "commercial" %}selected{% endif %}>Commercial</option>
                      </select>
                  </div>
                  <div class="mb-4">
                      <label class="label">
                          <span class="label-text">Street</span>
                      </label>
                      <input type="text" name="street" class="input input-bordered w-full" value="{{ property.street }}" required>
                  </div>
                  <div class="mb-4">
                      <label class="label">
                          <span class="label-text">Building No</span>
                      </label>
                      <input type="text" name="building_no" class="input input-bordered w-full" value="{{ property.building_no }}" required>
                  </div>
                  <div class="mb-4">
                      <label class="label">
                          <span class="label-text">City</span>
                      </label>
                      <input type="text" name="city" class="input input-bordered w-full" value="{{ property.city }}" required>
                  </div>
                  <div class="mb-4">
                      <label class="label">
                          <span class="label-text">ZIP</span>
                      </label>
                      <input type="text" name="zip" class="input input-bordered w-full" value="{{ property.zip }}" required>
                  </div>
                  <div class="mb-4">
                      <label class="label">
                          <span class="label-text">Country</span>
                      </label>
                      <input type="text" name="country" class="input input-bordered w-full" value="{{ property.country }}" required>
                  </div>
                  <div class="mb-4">
                      <label class="label">
                          <span class="label-text">Landlords</span>
                      </label>
                      <select name="landlords" class="select select-bordered w-full" multiple>
                          {% for landlord in all_landlords %}
                          <option value="{{ landlord.id }}" {% if landlord in property.landlords.all %}selected{% endif %}>
                              {{ landlord.name }}
                          </option>
                          {% endfor %}
                      </select>
                  </div>

                  <!-- Units -->
                  <div class="mb-4">
                      <h2 class="text-lg font-bold">Units</h2>

                      <!-- Include the management form -->
                      {{ unit_formset.management_form }}

                      <div id="units-container-edit" class="space-y-4">
                          {% for form in unit_formset %}
                          <div class="unit-row flex space-x-4">
                              <!-- Unit Name -->
                              <input type="text" name="{{ form.unit_name.name }}" class="input input-bordered w-full" placeholder="Unit Name" value="{{ form.unit_name.value|default_if_none:'' }}" required>
                              
                              <!-- Rooms -->
                              <input type="number" name="{{ form.rooms.name }}" class="input input-bordered w-full" placeholder="Beds" value="{{ form.rooms.value|default_if_none:'' }}" required>
                              
                              <!-- Baths -->
                              <input type="number" name="{{ form.baths.name }}" class="input input-bordered w-full" placeholder="Baths" value="{{ form.baths.value|default_if_none:'' }}" required>
                              
                              <!-- Floor Area -->
                              <input type="text" name="{{ form.floor_area.name }}" class="input input-bordered w-full" placeholder="Size (sq. ft.)" value="{{ form.floor_area.value|default_if_none:'' }}" required>
                              
                              <!-- Market Rent -->
                              <input type="text" name="{{ form.market_rent.name }}" class="input input-bordered w-full" placeholder="Market Rent" value="{{ form.market_rent.value|default_if_none:'' }}" required>
                              
                              <!-- Remove Unit Button -->
                              <button type="button" class="btn btn-xs btn-outline btn-error btn-circle text-sm" onclick="removeUnit(this)">✕</button>
                          </div>
                          {% endfor %}
                      </div>

                      <!-- Add Unit Button -->
                      <button type="button" class="btn btn-outline mt-3" onclick="addUnit_edit()">+ Add Another Unit</button>
                  </div>
              </div>
          </div>
      </details>
  </div>

</div>

<script>
    let unitCount = {{ unit_formset.total_form_count|default:0 }}; // Start with the total count of units for editing

    function addUnit_edit() {
        const container = document.getElementById('units-container-edit'); // Use unique ID for edit modal
        const unitRow = document.createElement('div');
        unitRow.className = 'unit-row flex space-x-4';

        unitRow.innerHTML = `
            <input type="text" name="units-${unitCount}-unit_name" class="input input-bordered w-full" placeholder="Unit Name" required>
            <input type="number" name="units-${unitCount}-rooms" class="input input-bordered w-full" placeholder="Beds" required>
            <input type="number" name="units-${unitCount}-baths" class="input input-bordered w-full" placeholder="Baths" required>
            <input type="text" name="units-${unitCount}-floor_area" class="input input-bordered w-full" placeholder="Size (sq. ft.)" required>
            <input type="text" name="units-${unitCount}-market_rent" class="input input-bordered w-full" placeholder="Market Rent" required>
            <button type="button" class="btn btn-xs btn-outline btn-error btn-circle text-sm" onclick="removeUnit(this)">✕</button>
        `;
        container.appendChild(unitRow);
        unitCount++;
    }

    function removeUnit(button) {
        const row = button.parentElement;
        row.remove();
    }
</script>

{% endblock %}
