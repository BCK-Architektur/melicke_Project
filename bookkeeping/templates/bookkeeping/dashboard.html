<div class="card bg-base-100 shadow-md p-5 w-full max-w-4xl mx-auto">
    <!-- Dashboard Header -->
    <h1 class="text-2xl font-bold mb-5">Dashboard for {{ property.name }}</h1>

    <!-- Upload Bank Statement Button -->
    <button class="btn btn-outline mb-5" onclick="upload_modal.showModal()">Upload Bank Statement</button>

    <!-- Upload Modal -->
    <dialog id="upload_modal" class="modal">
        <div class="modal-box bg-base-100 text-base-content">
            <form method="post" enctype="multipart/form-data" action="{% url 'upload_bank_statement' property.id %}">

                {% csrf_token %}
                <button type="button" class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2" onclick="upload_modal.close()">âœ•</button>
                <h1 class="text-lg font-bold mb-4">Upload Bank Statement</h1>

                <!-- File Input -->
                <div class="mb-4">
                    <input type="file" name="statement" class="file-input file-input-bordered file-input-sm w-full max-w-xs" required>
                </div>

                <!-- Submit and Cancel Buttons -->
                <div class="flex justify-end">
                    <button type="submit" class="btn btn-outline">Upload</button>
                    <button type="button" class="btn btn-outline btn-error" onclick="upload_modal.close()">Cancel</button>
                </div>
            </form>
        </div>
    </dialog>

    <!-- Earmarked Transactions Table -->
    <div class="overflow-x-auto mb-10">
        <h2 class="text-xl font-semibold mb-3">Earmarked Transactions for {{ property.name }}</h2>
        <table class="table w-full text-left bg-base-100 text-base-content">
            <thead>
                <tr>
                    <th>Account Name</th>
                    <th>Date</th>
                    <th>Amount</th>
                    <th>Description</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for transaction in earmarked %}
                <tr>
                    <td>{{ transaction.account_name }}</td>
                    <td>{{ transaction.date }}</td>
                    <td class="{% if transaction.is_income %}text-success{% else %}text-error{% endif %}">
                        {{ transaction.amount }}
                    </td>
                    <td>{{ transaction.description }}</td>
                    <td>
                        {% if transaction.is_income %}
                        <button class="btn btn-sm btn-outline btn-success" onclick="openIncomeModal('{{ transaction.account_name }}')">
                            + Income
                        </button>
                        {% else %}
                        <button class="btn btn-sm btn-outline btn-error" onclick="openExpenseModal('{{ transaction.account_name }}')">
                            + Expense
                        </button>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center text-base-content/50">No earmarked transactions available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Parsed Transactions Table -->
    <div class="overflow-x-auto">
        <h2 class="text-xl font-semibold mb-3">Parsed Transactions for {{ property.name }}</h2>
        <table class="table w-full text-left bg-base-100 text-base-content">
            <thead>
                <tr>
                    <th>BN</th>
                    <th>Date</th>
                    <th>Transaction Type</th>
                    <th>Property Name</th>
                    <th>Unit Name</th>
                    <th>Gross Amount</th>
                    <th>UST</th>
                    <th>Net Amount</th>
                </tr>
            </thead>
            <tbody>
                {% for transaction in parsed %}
                <tr>
                    <td>{{ transaction.booking_no }}</td>
                    <td>{{ transaction.date }}</td>
                    <td>{{ transaction.transaction_type }}</td>
                    <td>{{ transaction.property_name }}</td>
                    <td>{{ transaction.unit_name }}</td>
                    <td class="{% if transaction.betrag_brutto > 0 %}text-primary{% else %}text-error{% endif %}">
                        {{ transaction.betrag_brutto }}
                    </td>
                    <td>{{ transaction.ust }}</td>
                    <td class="{% if transaction.betrag_netto > 0 %}text-primary{% else %}text-error{% endif %}">
                        {{ transaction.betrag_netto }}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="text-center text-base-content/50">No parsed transactions available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    function openIncomeModal(accountName) {
        document.getElementById('income_account_name').value = accountName;
        document.getElementById('add_income_modal').showModal();
    }

    function openExpenseModal(accountName) {
        document.getElementById('expense_account_name').value = accountName;
        document.getElementById('add_expense_modal').showModal();
    }
</script>
